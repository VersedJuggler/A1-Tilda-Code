<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />

        <script
            src="https://unpkg.com/react@18/umd/react.development.js"
            crossorigin
        ></script>
        <script
            src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"
            crossorigin
        ></script>
        <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
        <script src="https://cdn.tailwindcss.com"></script>
        <script src="https://cdn.jsdelivr.net/npm/clsx@2.1.1/dist/clsx.min.js"></script>
    </head>

    <script type="text/babel" data-type="module">
        const container = document.getElementById("header");
        const root = ReactDOM.createRoot(container);

        function NavMenu({ items, hideSquares }) {
            return (
                <div>
                    <ul className="flex flex-col gap-3 !pl-0">
                        {items.map((item) => (
                            <li key={item.href} className="flex items-center gap-4">
                                {!hideSquares && (
                                    <div className="h-2 w-2 rounded-sm flex-none bg-black"></div>
                                )}
                                <a
                                    href={item.href}
                                    className="!text-black hover:!text-opacity-60 whitespace-nowrap"
                                >
                                    {item.label}
                                </a>
                            </li>
                        ))}
                    </ul>
                </div>
            );
        }

        function NavItem({ label, icon, menu }) {
            const [isOpen, setOpen] = React.useState(false);
            const [isVisible, setVisible] = React.useState(false);
            const closeTimer = React.useRef(null);
            const removeTimer = React.useRef(null);

            // определяем, нужен ли минус-иконка
            const showToggleIcon = label === "Услуги компании" || label === "Новостройки";
            const plusIcon = "https://raw.githubusercontent.com/VersedJuggler/A1-Tilda-Code/refs/heads/main/header/img/Group%20%2B.svg";
            const minusIcon = "https://raw.githubusercontent.com/VersedJuggler/A1-Tilda-Code/refs/heads/main/header/img/Vector%20-.svg";

            const handleMouseOver = () => {
                if (closeTimer.current) {
                    clearTimeout(closeTimer.current);
                    closeTimer.current = null;
                }
                if (removeTimer.current) {
                    clearTimeout(removeTimer.current);
                    removeTimer.current = null;
                }
                setVisible(true);
                // задержка для плавного появления
                setTimeout(() => setOpen(true), 10);
            };

            const handleMouseLeave = () => {
                closeTimer.current = setTimeout(() => {
                    setOpen(false);
                    removeTimer.current = setTimeout(() => {
                        setVisible(false);
                    }, 300); // время анимации
                }, 500); // задержка перед исчезновением
            };

            React.useEffect(() => {
                return () => {
                    if (closeTimer.current) clearTimeout(closeTimer.current);
                    if (removeTimer.current) clearTimeout(removeTimer.current);
                };
            }, []);

            return (
                <div
                    onMouseOver={handleMouseOver}
                    onMouseLeave={handleMouseLeave}
                    className="flex relative gap-3 items-center h-full"
                >
                    {showToggleIcon ? (
                        <span className="relative" style={{ width: '13.5px', height: '13.5px', display: 'inline-flex', alignItems: 'center', justifyContent: 'center' }}>
                            <img
                                src={plusIcon}
                                alt="plus"
                                className={`absolute left-0 top-0 transition-opacity duration-300 ${isOpen ? 'opacity-0' : 'opacity-100'}`}
                                style={{ width: '13.5px', height: '13.5px', pointerEvents: 'none' }}
                            />
                            <img
                                src={minusIcon}
                                alt="minus"
                                className={`absolute left-0 top-0 transition-opacity duration-300 ${isOpen ? 'opacity-100' : 'opacity-0'}`}
                                style={{ width: '13.5px', height: '13.5px', pointerEvents: 'none' }}
                            />
                        </span>
                    ) : (
                        <img src={icon} alt={label} />
                    )}

                    <span className="text-white">{label}</span>

                    {isVisible && (
                        <div
                            className={`absolute top-[calc(100%+8px)] left-0 bg-white rounded-lg shadow-md py-4 px-4 w-fit transition-all duration-300 overflow-hidden ${isOpen ? 'opacity-100 translate-y-0 max-h-[500px]' : 'opacity-0 -translate-y-4 max-h-0 pointer-events-none'}`}
                            style={{
                                transition: 'opacity 0.3s, transform 0.3s, max-height 0.3s',
                            }}
                        >
                            {menu}
                        </div>
                    )}
                </div>
            );
        }

        function HeaderMenu() {
            const [isOpen, setOpen] = React.useState(false);
            const [isVisible, setVisible] = React.useState(false);
            const closeTimer = React.useRef(null);
            const removeTimer = React.useRef(null);

            const burgerClosed = "https://raw.githubusercontent.com/VersedJuggler/A1-Tilda-Code/refs/heads/main/header/img/burger%20close.svg";
            const burgerOpen = "https://raw.githubusercontent.com/VersedJuggler/A1-Tilda-Code/refs/heads/main/header/img/burger%20open.svg";

            const handleMouseOver = () => {
                if (closeTimer.current) {
                    clearTimeout(closeTimer.current);
                    closeTimer.current = null;
                }
                if (removeTimer.current) {
                    clearTimeout(removeTimer.current);
                    removeTimer.current = null;
                }
                setVisible(true);
                setTimeout(() => setOpen(true), 10);
            };

            const handleMouseLeave = () => {
                closeTimer.current = setTimeout(() => {
                    setOpen(false);
                    removeTimer.current = setTimeout(() => {
                        setVisible(false);
                    }, 300);
                }, 500);
            };

            React.useEffect(() => {
                return () => {
                    if (closeTimer.current) clearTimeout(closeTimer.current);
                    if (removeTimer.current) clearTimeout(removeTimer.current);
                };
            }, []);

            return (
                <div
                    onMouseOver={handleMouseOver}
                    onMouseLeave={handleMouseLeave}
                    className="flex relative gap-3 items-center h-full"
                >
                    <span className="relative flex items-center justify-center" style={{ minWidth: '24px', minHeight: '24px' }}>
                        <img
                            src={burgerClosed}
                            alt="burger closed"
                            className={`absolute left-0 top-0 transition-opacity duration-300 ${isOpen ? 'opacity-0' : 'opacity-100'}`}
                            style={{ pointerEvents: 'none', width: '100%', height: '100%' }}
                        />
                        <img
                            src={burgerOpen}
                            alt="burger open"
                            className={`absolute left-0 top-0 transition-opacity duration-300 ${isOpen ? 'opacity-100' : 'opacity-0'}`}
                            style={{ pointerEvents: 'none', width: '100%', height: '100%' }}
                        />
                    </span>
                    <span className="text-white hidden md:block">МЕНЮ</span>
                    {isVisible && (
                        <div
                            className={`absolute top-[calc(100%+8px)] right-[-1rem] md:right-[-2.5rem] bg-white rounded-lg w-fit flex flex-col shadow-md transition-all duration-300 overflow-hidden ${isOpen ? 'opacity-100 translate-y-0 max-h-[800px]' : 'opacity-0 -translate-y-4 max-h-0 pointer-events-none'}`}
                            style={{
                                transition: 'opacity 0.3s, transform 0.3s, max-height 0.3s',
                            }}
                        >
                            <div className="flex flex-col md:flex-row gap-4 md:gap-16 p-4 md:p-6">
                                <div className="flex flex-col gap-4">
                                    <h4 className="text-sm text-black text-opacity-60">
                                        О компании
                                    </h4>

                                    <NavMenu
                                        items={[
                                        { label: "О компании", href: "https://a1-brokers.com/about-us" }, 
                                        { label: "Контакты", href: "#" },
                                        { label: "Сотрудники", href: "https://a1-brokers.com/teammates" }, 
                                        { label: "Наши партнеры", href: "#" },
                                        { label: "Вакансии", href: "#" }]}
                                        hideSquares={true}
                                    />
                                </div>

                                <div className="flex flex-col gap-4">
                                    <h4 className="text-sm text-black text-opacity-60">
                                        Другие разделы
                                    </h4>

                                    <NavMenu
                                        items={[
                                        { label: "Медиа/блог", href: "#" },
                                        { label: "Отзывы", href: "#" }]}
                                        hideSquares={true}
                                    />
                                    <div className="flex flex-row gap-4 mt-2">
                                        <a href="https://wa.me/" target="_blank" rel="noopener noreferrer">
                                            <img src="https://raw.githubusercontent.com/VersedJuggler/A1-Tilda-Code/refs/heads/main/header/img/WhatsApp.png" alt="WhatsApp" className="h-8 w-8" />
                                        </a>
                                        <a href="https://vk.com/" target="_blank" rel="noopener noreferrer">
                                            <img src="https://raw.githubusercontent.com/VersedJuggler/A1-Tilda-Code/refs/heads/main/header/img/VK.png" alt="VK" className="h-8 w-8" />
                                        </a>
                                        <a href="https://t.me/" target="_blank" rel="noopener noreferrer">
                                            <img src="https://raw.githubusercontent.com/VersedJuggler/A1-Tilda-Code/refs/heads/main/header/img/Telegram.png" alt="Telegram" className="h-8 w-8" />
                                        </a>
                                    </div>
                                </div>
                                    
                            </div>
                            <hr className="border-black border-opacity-20" />
                            <div className="flex flex-col md:flex-row gap-4 md:gap-16 p-4 md:p-6">
                                <div className="flex flex-col gap-4">
                                    <h4 className="text-sm text-black text-opacity-60">
                                        Контакты
                                    </h4>

                                    <a
                                        href="tel:+78432537989"
                                        className="text-black whitespace-nowrap"
                                    >
                                        +7 (843) 253 79 89
                                    </a>
                                </div>

                                <div className="flex flex-col gap-4">
                                    <h4 className="text-sm text-black text-opacity-60">
                                        Адрес офиса
                                    </h4>

                                    <p className="text-black whitespace-nowrap">
                                        Казань, ул. Чистопольская
                                        <br />д. 88 (офис 4)
                                    </p>
                                </div>
                            </div>
                        </div>
                    )}
                </div>
            );
        }

        function Header() {
            const [scrolled, setScrolled] = React.useState(false);
            const [screenHeight, setScreenHeight] = React.useState(
                window.innerHeight
            );

            React.useEffect(() => {
                const handleScroll = () => {
                    const scrollY = window.scrollY;

                    if (scrollY >= screenHeight * 0.9) {
                        setScrolled(true);
                    } else {
                        setScrolled(false);
                    }
                };

                const handleResize = () => {
                    setScreenHeight(window.innerHeight);
                };

                window.addEventListener("scroll", handleScroll);
                window.addEventListener("resize", handleResize);

                handleScroll();

                return () => {
                    window.removeEventListener("scroll", handleScroll);
                    window.removeEventListener("resize", handleResize);
                };
            }, [screenHeight]);

            return (
                <header
                    className={clsx(
                        "fixed z-[9999] top-6 left-1/2 -translate-x-1/2 w-[90vw] flex gap-4 z-20 px-4 md:px-10 items-center border border-white border-opacity-20 rounded-lg h-20 backdrop-blur transition-colors duration-700",
                        scrolled ? "bg-black bg-opacity-60" : "bg-[#C4C4C414]"
                    )}
                >
                    <a href="https://a1-brokers.com">
                        <img
                          src="https://storage.yandexcloud.net/a1-broker/logo.svg"
                            alt="logo"
                            className="h-10"
                        />
                    </a>

                    <div className="flex-1 hidden md:flex h-full items-center justify-center gap-16">
                        <NavItem
                            label="Услуги компании"
                            icon="https://storage.yandexcloud.net/a1-broker/plus_icon.svg"
                            menu={
                                <NavMenu
                                    items={[{ label: "Оформление ипотеки", href: "" }, { label: "Страхование", href: "" }, { label: "Оценка недвижимости", href: "" }, { label: "Строительство домов", href: "" }, { label: "Аренда квартиры", href: "" }]}
                                />
                            }
                        />

                        <NavItem
                            label="Новостройки"
                            icon="https://storage.yandexcloud.net/a1-broker/plus_icon.svg"
                            menu={
                                <NavMenu
                                    items={[{ label: "Казань", href: "" }, { label: "Москва", href: "" }, { label: "Санкт-Петербург", href: "" }, { label: "Сочи", href: "" }, { label: "Крым", href: "" }, { label: "Апартаменты в ОАЭ", href: "" }]}
                                />
                            }
                        />
                    </div>

                    <div className="flex h-full items-center gap-12">
                        <button className="hidden md:block bg-white flex items-center justify-center rounded py-3 px-6 text-sm">
                            Связаться
                        </button>

                        <HeaderMenu />
                    </div>
                </header>
            );
        }

        root.render(<Header />);
    </script>

    <body style="font-family: 'Inter', sans-serif">
        <div id="header"></div>
    </body>
</html>