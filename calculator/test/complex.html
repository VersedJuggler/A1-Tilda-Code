<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />

        <script
            src="https://unpkg.com/react@18/umd/react.development.js"
            crossorigin
        ></script>
        <script
            src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"
            crossorigin
        ></script>
        <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
        <script src="https://cdn.tailwindcss.com"></script>
        <script src="https://cdn.jsdelivr.net/npm/clsx@2.1.1/dist/clsx.min.js"></script>
        <style>
            .containerrsbxyUJEoYDu {
                overflow: hidden;
                position: absolute;
                top: 0;
                left: 0;
                display: flex;
                align-items: center;
                justify-content: center;
                width: 100%;
                height: 100vh;
                background-color: rgba(0, 0, 0, 0.61);
                backdrop-filter: blur(5px);
            }
            
            .formContainerrsbxyUJEoYDu {
            
                width: 500px;
                display: flex;
                flex-direction: column;
                align-items: center;
                justify-content: center;
            
                background-color: #f6f6f6;
                color: #000000;
            
                border-radius: 12px;
            
                padding: 30px;
            
                gap: 20px;
                
                position: relative;
            }
            
            .formrsbxyUJEoYDu {
                display: flex;
                flex-direction: column;
                gap: 10px;
                align-items: center;
                justify-content: center;
            
                width: 70%;
                z-index: 3;
            }
            
            .inputrsbxyUJEoYDu {
                box-sizing:border-box;
                border-radius: 4px;
            
                padding: 0 15px;
            
                height: 50px;
                font-size: 14px;
                outline: none;
                border: none;
            
                font: inherit;
            
                width: 100%;
                resize: none;
            }
            
            .inputrsbxyUJEoYDu:focus {
                outline: none;
            }
            
            .textarearsbxyUJEoYDu {
                box-sizing:border-box;
                border-radius: 4px;
            
                padding: 0 15px;
                padding-top: 10px;
            
                height: 50px;
                font-size: 14px;
                outline: none;
                border: none;
            
                font: inherit;
            
                width: 100%;
                resize: none;
            }
            
            .textarearsbxyUJEoYDu:focus {
                outline: none;
            }
            
            .headingrsbxyUJEoYDu {
                font-size: 28px;
                font-weight: 400;
            
                text-align: left;
                width: 70%;
            }
            
            .buttonrsbxyUJEoYDu {
                box-sizing:border-box;
                width: 100%;
                height: 50px;
                padding: 0 15px;
            
                font-size: 12px;
                font-weight: 600;
            
                text-align: center;
            
                background-color: #000000;
                color: #ffffff;
            
                border-radius: 4px;
            
                outline: none;
                border: none;
                cursor: pointer;
            }
            
            .buttonrsbxyUJEoYDu:focus {
                outline: none;
                border: none;
            }
            
            .imagersbxyUJEoYDu {
                position: absolute;
                left: 0;
                top: 40px;
                width: 150px;
                height: auto;
                z-index: 1
            }
            .crossrsbxyUJEoYDu {
                cursor: pointer;
                position: absolute;
                left: 30px;
                top: 30px;
                
            }
        </style>
    </head>

    <script type="text/babel" data-type="module">
        const container = document.getElementById("root");
        const root = ReactDOM.createRoot(container);

        const searchParams = new URLSearchParams(window.location.search);

        function ItemBackground() {
            return (
                <div
                    className="absolute inset-0 h-screen w-full brightness-50 bg-no-repeat bg-cover bg-center"
                    style={{
                        backgroundImage:
                            "url('https://storage.yandexcloud.net/a1-broker/city-bg.png')",
                    }}
                ></div>
            );
        }

        function ItemDetails({ item }) {
            return (
                <div className="flex flex-col gap-12 flex-1">
                    <div className="flex flex-col gap-2">
                        {item.subways &&
                            item.subways.map((subway, index) => {
                                if (index < 2) {
                                    return (
                                        <div
                                            key={subway.name}
                                            className="flex items-center gap-3"
                                        >
                                            <div
                                                className="rounded-full w-3 h-3"
                                                style={{
                                                    backgroundColor:
                                                        subway.color_hex,
                                                }}
                                            ></div>
                                            <h4 className="text-black md:text-white text-sm md:text-lg">
                                                {subway.name},{" "}
                                                {subway.distance_text}
                                            </h4>
                                        </div>
                                    );
                                }
                            })}
                    </div>

                    <div className="w-full flex flex-col text-sm md:text-base">
                        <div className="flex items-center justify-between py-3">
                            <span className="text-black md:text-white text-opacity-50 md:text-opacity-100">
                                Класс недвижимости
                            </span>
                            <span className="text-black md:text-white md:text-opacity-100">
                                {item.property_class}
                            </span>
                        </div>

                        <hr className="border-black/30 md:border-white/50" />

                        <div className="flex items-center justify-between py-3">
                            <span className="text-black md:text-white text-opacity-50 md:text-opacity-100">
                                Старт продаж
                            </span>
                            <span className="text-black md:text-white md:text-opacity-100">
                                {item.sale_start}
                            </span>
                        </div>

                        <hr className="border-black/30 md:border-white/50" />

                        <div className="flex items-center justify-between py-3">
                            <span className="text-black md:text-white text-opacity-50 md:text-opacity-100">
                                Срок передачи ключей
                            </span>
                            <span className="text-black md:text-white md:text-opacity-100">
                                {item.key_delivery_deadline}
                            </span>
                        </div>

                        <hr className="border-black/30 md:border-white/50" />

                        <div className="flex items-center justify-between py-3">
                            <span className="text-black md:text-white text-opacity-50 md:text-opacity-100">
                                Тип дома
                            </span>
                            <span className="text-black w-1/2 text-end  md:text-white md:text-opacity-100">
                                {item.type}
                            </span>
                        </div>

                        <hr className="border-black/30 md:border-white/50" />

                        <div className="flex items-center justify-between py-3">
                            <span className="text-black md:text-white text-opacity-50 md:text-opacity-100">
                                Фасад
                            </span>
                            <span className="text-black w-1/2 text-end md:text-white md:text-opacity-100">
                                {item.facade}
                            </span>
                        </div>

                        <hr className="border-black/30 md:border-white/50" />

                        <div className="flex items-center justify-between py-3">
                            <span className="text-black md:text-white text-opacity-50 md:text-opacity-100">
                                Отделка
                            </span>
                            <span className="text-black md:text-white md:text-opacity-100">
                                {item.decoration}
                            </span>
                        </div>

                        <hr className="border-black/30 md:border-white/50" />

                        <div className="flex items-center justify-between py-3">
                            <span className="text-black md:text-white text-opacity-50 md:text-opacity-100">
                                Паркинг
                            </span>
                            <span className="text-black md:text-white md:text-opacity-100">
                                {item.parking}
                            </span>
                        </div>

                        <hr className="border-black/30 md:border-white/50" />

                        <div className="flex items-center justify-between py-3">
                            <span className="text-black md:text-white text-opacity-50 md:text-opacity-100">
                                Лифт
                            </span>
                            <span className="text-black md:text-white md:text-opacity-100">
                                {item.elevator}
                            </span>
                        </div>
                    </div>

                    <div className="flex flex-col gap-2 text-white">
                        <span className="text-sm md:text-base text-black md:text-white">
                            Стоимость
                        </span>

                        <h2 className="text-4xl md:text-5xl text-black md:text-white">
                            от{" "}
                            {item.price?.toLocaleString("ru-RU", {
                                style: "currency",
                                currency: "RUB",
                            })}
                        </h2>
                    </div>
                </div>
            );
        }
        
        function Modal ( { onClose } ) {
          const [name, setName] = React.useState('');
          const [phone, setPhone] = React.useState('');
          const [comment, setComment] = React.useState('');
        
          const sendData = () => {
            fetch("https://a1-brokers.ru/api/complex/presentation/download/", {
              method: 'post',
              headers: new Headers({'content-type': 'application/json'}),
              body: JSON.stringify({
                "complex_url": window.location.href,
                "fullname": name,
                "phone": phone,
                "comment": comment,
              }),
            }).then(() => {
              console.log('done')
            }).catch(() => {
              console.log('error')
            });
          }
        
          return (
            <div className={'containerrsbxyUJEoYDu'}>
                <div className={'formContainerrsbxyUJEoYDu'}>
                    <img className={'crossrsbxyUJEoYDu'} src={'https://static.tildacdn.com/tild6365-3164-4338-b966-396534383132/444.svg'} onClick={onClose} alt={"can't load"} />
                    <div className={'headingrsbxyUJEoYDu'}>
                        Оставьте
                        <br />
                        свои контакты
                    </div>
                    <div className={'formrsbxyUJEoYDu'}>
                        <input type="text" className={'inputrsbxyUJEoYDu'} placeholder='Имя' value={name} onChange={(e) => { setName(e.target.value) }} />
                        <input type="tel" className={'inputrsbxyUJEoYDu'} placeholder='+7(' value={phone} onChange={(e) => { setPhone(e.target.value) }} />
                        <textarea name="" id="" className={'textarearsbxyUJEoYDu'} rows={5} placeholder='Комментарий' value={comment} onChange={(e) => { setComment(e.target.value) }}></textarea>
                        <button className={'buttonrsbxyUJEoYDu'} onClick={sendData}>Отправить</button>
                    </div>
                </div>
            </div>
          );
        }

        function ItemCard({ item }) {
            const currentCity = window.location.href.split('?')[1].split('&')[0].split('=')[1]
            
            const [modalOpen, setModalOpen] = React.useState(false)
            
            return (
                <div className="h-[80vh] w-full md:w-[80vh] bg-white rounded-lg flex flex-col gap-6 md:gap-0 p-[32px] justify-between">
                    {
                        modalOpen &&
                        <Modal onClose={() => { setModalOpen(false) }} />
                    }
                    <div className="flex flex-col gap-2 md:gap-0 md:flex-row md:items-center md:justify-between md:py-3">
                        <a
                            href={"https://a1-brokers.com/search?city=" + currentCity}
                            className="flex items-center gap-3 text-sm md:text-base !text-black !text-opacity-60"
                        >
                            <img
                                src="https://storage.yandexcloud.net/a1-broker/arrow-left.svg"
                                alt="back"
                            />
                            на главную
                        </a>

                        <div className="flex gap-3 md:gap-6 items-center">
                            <h4 className="text-end text-black text-sm md:text-base text-opacity-60">
                                {item.address}
                            </h4>
                            <img
                                src="https://storage.yandexcloud.net/a1-broker/square.svg"
                                alt="square"
                                className="w-3 h-3"
                            />
                        </div>
                    </div>

                    <div className="flex flex-col">
                        <h1 className="text-4xl md:text-6xl md:tracking-[-4px] leading-[40px] md:leading-[60px]">
                            {item.name}
                        </h1>
                        <h3 className="text-base md:text-2xl leading-[24px] w-2/3 mt-8">
                            {item.subtitle}
                        </h3>

                        <p className="text-sm md:text-lg md:leading-[19.2px] text-black text-opacity-50 mt-12 w-[90%]">
                            {item.description}
                        </p>
                    </div>

                    <div className="flex flex-col md:flex-row gap-4 w-full">
                        <a
                            href={item.presentation_link}
                            className="cursor-pointer bg-white text-sm md:text-base !border !border-black !border-solid w-full !text-black flex items-center justify-center rounded h-16"
                            onClick={() => { setModalOpen(true) }}
                        >
                            Скачать презентацию
                        </a>

                        <button className="bg-black text-sm md:text-base w-full text-white flex items-center justify-center rounded h-16">
                            Позвонить в офис
                        </button>
                    </div>
                </div>
            );
        }

        function ItemContainer({ item }) {
            return (
                <div className="h-fit md:h-screen relative px-[5vw] pt-[15vh] flex flex-col gap-6">
                    <ItemBackground />

                    {item && (
                        <div className="flex flex-col z-20 gap-20 md:flex-row md:items-center">
                            <ItemCard item={item} />

                            <ItemDetails item={item} />
                        </div>
                    )}
                </div>
            );
        }

        function ItemImageCard({ image }) {
            return (
                <div
                    className="overflow-hidden h-full w-full rounded-lg"
                    style={{
                        backgroundImage: `url(${image.image_url})`,
                        backgroundPosition: "center",
                        backgroundSize: "cover",
                    }}
                ></div>
            );
        }

        function ItemImages({ itemImages }) {
            const [currentIndex, setCurrentIndex] = React.useState(0);

            const handlePrevClick = () => {
                const newIndex =
                    currentIndex === 0
                        ? itemImages.length - 1
                        : currentIndex - 1;
                setCurrentIndex(newIndex);
            };

            const handleNextClick = () => {
                const newIndex =
                    currentIndex === itemImages.length - 1
                        ? 0
                        : currentIndex + 1;
                setCurrentIndex(newIndex);
            };

            return (
                <div className="flex flex-col">
                    <div className="relative mt-20 w-full aspect-square md:w-[80vh] md:h-[60vh]">
                        <button
                            onClick={handlePrevClick}
                            className="absolute z-10 left-4 top-1/2 -translate-y-1/2 bg-white rounded-full p-2"
                        >
                            <svg
                                class="w-3 h-3 text-white dark:text-gray-800 rtl:rotate-180"
                                aria-hidden="true"
                                xmlns="http://www.w3.org/2000/svg"
                                fill="none"
                                viewBox="0 0 6 10"
                            >
                                <path
                                    stroke="currentColor"
                                    stroke-linecap="round"
                                    stroke-linejoin="round"
                                    stroke-width="2"
                                    d="M5 1 1 5l4 4"
                                />
                            </svg>
                        </button>

                        <ItemImageCard image={itemImages[currentIndex]} />

                        <button
                            onClick={handleNextClick}
                            className="absolute z-10 right-4 top-1/2 -translate-y-1/2 bg-white rounded-full p-2"
                        >
                            <svg
                                class="w-3 h-3 text-white dark:text-gray-800 rtl:rotate-180"
                                aria-hidden="true"
                                xmlns="http://www.w3.org/2000/svg"
                                fill="none"
                                viewBox="0 0 6 10"
                            >
                                <path
                                    stroke="currentColor"
                                    stroke-linecap="round"
                                    stroke-linejoin="round"
                                    stroke-width="2"
                                    d="m1 9 4-4-4-4"
                                />
                            </svg>
                        </button>
                    </div>

                    <div className="hidden md:flex gap-3 mt-10 max-w-[80vh] overflow-x-scroll">
                        {itemImages.map((image, index) => (
                            <div
                                key={image.id}
                                className="flex-none h-20 w-20 rounded-xl"
                                onClick={() => setCurrentIndex(index)}
                            >
                                <img
                                    src={image.image_url}
                                    alt={image.id}
                                    className="h-full w-full object-cover rounded-xl"
                                />
                            </div>
                        ))}
                    </div>
                </div>
            );
        }

        function ItemAdvantages({ advantages }) {
            return (
                <div className="flex flex-col gap-4 pt-20 w-full">
                    {advantages.map((advantage) => (
                        <div className="relative w-full flex bg-white flex-col rounded-lg h-28 justify-center px-8">
                            <div className="absolute top-2 right-2 w-4 h-4 bg-black rounded"></div>
                            <h6 className="text-xl font-medium">
                                {advantage.title}
                            </h6>
                            <p className="font-thin">{advantage.description}</p>
                        </div>
                    ))}
                    {/* Additional 4 static blocks */}
                    <div className="relative w-full flex bg-white flex-col rounded-lg h-28 justify-center px-8">
                        <div className="absolute top-6 right-6 w-3 h-3 bg-black rounded"></div>
                        <h6 className="text-xl font-medium">Природный оазис</h6>
                        <p className="font-thin">Собственный парк и река внутри города</p>
                    </div>
                    <div className="relative w-full flex bg-white flex-col rounded-lg h-28 justify-center px-8">
                        <div className="absolute top-6 right-6 w-3 h-3 bg-black rounded"></div>
                        <h6 className="text-xl font-medium">Доступность</h6>
                        <p className="font-thin">Собственный парк и река внутри города</p>
                    </div>
                    <div className="relative w-full flex bg-white flex-col rounded-lg h-28 justify-center px-8">
                        <div className="absolute top-6 right-6 w-3 h-3 bg-black rounded"></div>
                        <h6 className="text-xl font-medium">Природный оазис</h6>
                        <p className="font-thin">Собственный парк и река внутри города</p>
                    </div>
                    <div className="relative w-full flex bg-white flex-col rounded-lg h-28 justify-center px-8">
                        <div className="absolute top-6 right-6 w-3 h-3 bg-black rounded"></div>
                        <h6 className="text-xl font-medium">Доступность</h6>
                        <p className="font-thin">Собственный парк и река внутри города</p>
                    </div>
                </div>
            );
        }

        function ItemQueue({ itemQueue }) {
            return (
                <div className="flex flex-col gap-8">
                    <div className="flex justify-between text-lg bg-black/[0.04] p-2 md:p-0 rounded-lg md:bg-transparent">
                        <div className="flex items-center gap-2">
                            <img
                                className="md:hidden"
                                src="https://storage.yandexcloud.net/a1-broker/apartment.svg"
                            />
                            <h3 className="font-semibold">
                                {itemQueue.number} {itemQueue.building}{" "}
                                {itemQueue.delivery_term}
                            </h3>
                        </div>
                        <h3 className="px-2 py-1 md:p-0 bg-white md:bg-transparent md:font-semibold rounded-2xl text-sm md:text-base flex gap-2">
                            {itemQueue.apartments_count}{" "}
                            <span className="hidden md:block">квартир</span>
                        </h3>
                    </div>

                    <div className="w-full flex flex-col gap-4 md:gap-0">
                        {itemQueue.apartments.map((item) => (
                            <div
                                key={item.id}
                                className="bg-white md:bg-transparent rounded-lg md:rounded-none grid grid-cols-4 gap-3 px-4 md:px-0 py-3 md:!border-b md:!border-solid md:!border-black/20"
                            >
                                <h4 className="font-medium md:font-normal col-span-3 md:col-span-1">
                                    {item.type}
                                </h4>
                                <div className="md:hidden bg-[#ECECEC] px-2 py-1 rounded-2xl text-sm text-black justify-self-end">
                                    {item.count}
                                </div>
                                <h4 className="hidden md:block">
                                    {item.min_area} м² - {item.max_area} м²
                                </h4>
                                <div className="flex gap-2 text-sm md:hidden col-span-4">
                                    <h4 className="text-black">
                                        от{" "}
                                        {item.min_price.toLocaleString(
                                            "ru-RU",
                                            {
                                                style: "currency",
                                                currency: "RUB",
                                            }
                                        )}
                                    </h4>
                                    <h4 className="text-black/40">
                                        / от {item.min_area} м²
                                    </h4>
                                </div>
                                <h4 className="hidden md:block">
                                    {item.min_price.toLocaleString("ru-RU", {
                                        style: "currency",
                                        currency: "RUB",
                                    })}{" "}
                                    -{" "}
                                    {item.max_price.toLocaleString("ru-RU", {
                                        style: "currency",
                                        currency: "RUB",
                                    })}
                                </h4>
                                <h4 className="justify-self-end hidden md:block">
                                    {item.count} квартир
                                </h4>
                            </div>
                        ))}
                    </div>
                </div>
            );
        }

        function ItemQueues({ itemQueues }) {
            return (
                <div className="px-[5vw] pt-10 pb-12 md:pb-32 flex flex-col gap-12">
                    {itemQueues.map((itemQueue) => (
                        <ItemQueue key={itemQueue.id} itemQueue={itemQueue} />
                    ))}
                </div>
            );
        }

        function App() {
            const [item, setItem] = React.useState();

            const id = searchParams.get("id");

            React.useEffect(() => {
                fetch(`https://a1-brokers.ru/api/complex/${id}/get`)
                    .then((response) => response.json())
                    .then((data) => {
                        setItem(data);
                    });
            }, [id]);

            return (
                <div className="min-h-screen flex flex-col overflow-x-hidden font-['Inter'] bg-[#F6F6F6]">
                    <ItemContainer item={item} />

                    {item && (
                        <div className="flex flex-col md:flex-row gap-4 md:gap-20 px-[5vw]">
                            <ItemImages itemImages={item.images} />
                            <ItemAdvantages advantages={item.advantages} />
                        </div>
                    )}

                    {item && <ItemQueues itemQueues={item.queue} />}

                    <button className="md:hidden bg-black text-white mb-4 mx-auto w-[90vw] text-sm flex items-center justify-center rounded h-16">
                        Скачать презентацию
                    </button>
                </div>
            );
        }

        root.render(<App />);
    </script>

    <body style="font-family: 'Inter', sans-serif">
        <div id="root"></div>
    </body>
</html>
